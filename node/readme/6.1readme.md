- JavaScript对于字符串（string）的操作十分友好，无论是宽字节字符串还是单字节字符串，都被认为是一个字符串。
  console.log("0123456789".length); // 10
  console.log("零一二三四五六七八九".length); //10
  console.log("\u00bd".length); // 1 
- 对比PHP中的字符串统计，我们需要动用额外的函数来获取字符串的长度。
  <?phpecho strlen("0123456789"); // 10
  echo "\n";echo strlen("零一二三四五六七八九"); // 30
  echo "\n";echo mb_strlen("零一二三四五六七八九", "utf-8"); //10
  echo "\n";?>
- 文件和网络I/O对于前端开发者而言都是不曾有的应用场景，因为前端只需做一些简单的字符串操作或DOM操作基本就能满足业务需求，在ECMAScript规范中，也没有对这些方面做任何的定义，只有CommonJS中有部分二进制的定义。由于应用场景不同，在Node中，应用需要处理网络协议、操作数据库、处理图片、接收上传文件等，在网络流和文件的操作中，还要处理大量二进制数据，JavaScript自有的字符串远远不能满足这些需求，于是Buffer对象应运而生。



- Buffer结构
  Buffer是一个像Array的对象，但它主要用于操作字节。下面我们从模块结构和对象结构的层面上来认识它。

  模块结构
  Buffer是一个典型的JavaScript与C++结合的模块，它将性能相关部分用C++实现，将非性能相关的部分用JavaScript实现。

  第5章揭示了Buffer所占用的内存不是通过V8分配的，属于堆外内存。由于V8垃圾回收性能的影响，将常用的操作对象用更高效和专有的内存分配回收策略来管理是个不错的思路。

  由于Buffer太过常见，Node在进程启动时就已经加载了它，并将其放在全局对象（global）上。所以 在使用Buffer时，无须通过require()即可直接使用。


  Buffer对象
  Buffer对象类似于数组，它的元素为16进制的两位数，即0到255的数值。示例代码如下所示：

  《深入浅出Node.js》-读书笔记-理解Buffer
 发表于 2018-10-06 |  更新于 2020-05-10 |  分类于 读书笔记 |  评论数： 0 |  阅读次数： 68
理解Buffer
JavaScript对于字符串（string）的操作十分友好，无论是宽字节字符串还是单字节字符串，都被认为是一个字符串。示例代码如下所示：

console.log("0123456789".length); // 10
console.log("零一二三四五六七八九".length); //10
console.log("\u00bd".length); // 1
对比PHP中的字符串统计，我们需要动用额外的函数来获取字符串的长度。示例代码如下所示：

<?phpecho strlen("0123456789"); // 10
echo "\n";echo strlen("零一二三四五六七八九"); // 30
echo "\n";echo mb_strlen("零一二三四五六七八九", "utf-8"); //10
echo "\n";?>
文件和网络I/O对于前端开发者而言都是不曾有的应用场景，因为前端只需做一些简单的字符串操作或DOM操作基本就能满足业务需求，在ECMAScript规范中，也没有对这些方面做任何的定义，只有CommonJS中有部分二进制的定义。由于应用场景不同，在Node中，应用需要处理网络协议、操作数据库、处理图片、接收上传文件等，在网络流和文件的操作中，还要处理大量二进制数据，JavaScript自有的字符串远远不能满足这些需求，于是Buffer对象应运而生。

Buffer结构
Buffer是一个像Array的对象，但它主要用于操作字节。下面我们从模块结构和对象结构的层面上来认识它。

模块结构
Buffer是一个典型的JavaScript与C++结合的模块，它将性能相关部分用C++实现，将非性能相关的部分用JavaScript实现，如下图所示。

Buffer分工

第5章揭示了Buffer所占用的内存不是通过V8分配的，属于堆外内存。由于V8垃圾回收性能的影响，将常用的操作对象用更高效和专有的内存分配回收策略来管理是个不错的思路。

由于Buffer太过常见，Node在进程启动时就已经加载了它，并将其放在全局对象（global）上。所以 在使用Buffer时，无须通过require()即可直接使用。

Buffer对象
Buffer对象类似于数组，它的元素为16进制的两位数，即0到255的数值。

var str = "深入浅出node.js";
var buf = new Buffer(str, 'utf-8');
console.log(buf);
// => <Buffer e6 b7 b1 e5 85 a5 e6 b5 85 e5 87 ba 6e 6f 64 65 2e 6a 73>


不同编码的字符串占用的元素个数各不相同，上面代码中的中文字在UTF-8编码下占用3个元素，字母和半角标点符号占用1个元素。Buffer受Array类型的影响很大，可以访问length属性得到长度，也可以通过下标访问元素，在构造对象时也十分相似。

var buf = new Buffer(100);
console.log(buf.length); // => 100
上述代码分配了一个长100字节的Buffer对象。可以通过下标访问刚初始化的Buffer的元素，代码如下：

console.log(buf[10]);
这里会得到一个比较奇怪的结果，它的元素值是一个0到255的随机值。同样，我们也可以通过下标对它进行赋值：

buf[10] = 100;
console.log(buf[10]); // => 100
值得注意的是，如果给元素赋值不是0到255的整数而是小数时会怎样呢？示例代码如下所示：

buf[20] = -100;
console.log(buf[20]); // 156
buf[21] = 300;
console.log(buf[21]); // 44
buf[22] = 3.1415;
console.log(buf[22]); // 3
给元素的赋值如果小于0，就将该值逐次加256，直到得到一个0到255之间的整数。如果得到的数值大于255，就逐次减256，直到得到0~255区间内的数值。如果是小数，舍弃小数部分，只保留整数部分。